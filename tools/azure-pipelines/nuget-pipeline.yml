name: Nuget - $(Date:yyyy.MM.dd).$(BuildID)

pr: none
trigger: none

pool:
  vmImage: "ubuntu-latest"

variables:
  pipelineName: "nuget - Krosoft.Extensions.Zip"

steps:
  - task: AzureCLI@2
    inputs:
      scriptType: "bash"
      scriptLocation: "inlineScript"
      inlineScript: |
        # Rechercher l'ID de la pipeline par son nom
        pipelineId=$(az pipelines list --org $(System.CollectionUri) --project $(System.TeamProject) --query "[?name=='$(pipelineName)'].id" -o tsv)

        if [ -z "$pipelineId" ]; then
          echo "Erreur : Impossible de trouver l'ID de la pipeline '$(pipelineName)'."
          exit 1
        fi

        # DÃ©clencher la pipeline
        az pipelines run --org $(System.CollectionUri) --project $(System.TeamProject) --pipeline-id $pipelineId --token $(System.AccessToken)
