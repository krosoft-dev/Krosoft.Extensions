parameters:
  - name: sonarCloudEndpoint
    type: string

  - name: sonarCloudOrganization
    type: string

  - name: sonarCloudProjectKey
    type: string

  - name: sonarCloudProjectName
    type: string

steps:
  - task: SonarCloudPrepare@1
    displayName: "Prepare SonarCloud"
    inputs:
      SonarCloud: ${{ parameters.sonarCloudEndpoint }}
      organization: ${{ parameters.sonarCloudOrganization }}
      scannerMode: "MSBuild"
      projectKey: ${{ parameters.sonarCloudProjectKey }}
      projectName: ${{ parameters.sonarCloudProjectName }}
      extraProperties: |
        sonar.cs.opencover.reportsPaths="$(Build.SourcesDirectory)/**/coverage.opencover.xml"
        sonar.coverage.exclusions="**/Migrations/*.cs,**/*Tests*/**/*"
        sonar.exclusions="**/Migrations/*.cs,**/samples/**/*.*"
        sonar.verbose=true
        sonar.branch.name=$(Build.SourceBranchName)
